import{u as b,r as l,j as t,v as N,B as P,d as F,e as V,J as k,h as I,Z as O,w as f,C as S}from"./index-B5oqQfuu.js";import{g as D,d as T}from"./completedApplicationsStorage-BQzexCCT.js";import{T as d}from"./Toast-D2SR_lEB.js";function J(){const m=b(),[c,v]=l.useState([]),[g,h]=l.useState(!0),[a,o]=l.useState("all");l.useEffect(()=>{_()},[]);const _=()=>{try{const e=D();v(e),h(!1)}catch(e){console.error("Error loading applications:",e),d.error("Failed to load credit history"),h(!1)}},A=(e,s)=>{s.stopPropagation(),window.confirm("Are you sure you want to delete this application from history?")&&(T(e)?(d.success("Application deleted from history"),_()):d.error("Failed to delete application"))},u=(e,s)=>{s&&s.stopPropagation(),m("/credit-request/review",{state:{product:e.product,customer:e.customer,creditDecision:e.creditDecision,fromHistory:!0}})},E=(e,s)=>{const i=(s==null?void 0:s.decision)||(s==null?void 0:s.status);return i==="APPROVED"||i==="APPROVED"&&(s!=null&&s.isOverruleApproval)?t.jsx(I,{className:"credit-history-item__status-icon credit-history-item__status-icon--approved"}):i==="REJECTED"?t.jsx(O,{className:"credit-history-item__status-icon credit-history-item__status-icon--rejected"}):i==="MANUAL_REVIEW"?t.jsx(f,{className:"credit-history-item__status-icon credit-history-item__status-icon--manual"}):i==="ERROR"?t.jsx(S,{className:"credit-history-item__status-icon credit-history-item__status-icon--error"}):t.jsx(f,{className:"credit-history-item__status-icon"})},R=e=>{const s=(e==null?void 0:e.decision)||(e==null?void 0:e.status);return s==="APPROVED"&&(e!=null&&e.isOverruleApproval)?"Approved (Overrule)":s==="APPROVED"?"Approved":s==="REJECTED"?"Rejected":s==="MANUAL_REVIEW"?"Manual Review":s==="ERROR"?"Error":"Unknown"},w=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2}).format(e||0),C=e=>e?(e instanceof Date?e:new Date(e)).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A",y=c.filter(e=>{var i,r;if(a==="all")return!0;const s=((i=e.creditDecision)==null?void 0:i.decision)||((r=e.creditDecision)==null?void 0:r.status);return a==="approved"?s==="APPROVED":a==="rejected"?s==="REJECTED":a==="manual_review"?s==="MANUAL_REVIEW":!0});return g?t.jsx("div",{className:"credit-history-page",children:t.jsx("div",{className:"credit-history-page__loading",children:t.jsx("p",{children:"Loading credit history..."})})}):t.jsxs("div",{className:"credit-history-page",children:[t.jsxs("div",{className:"credit-history-page__header",children:[t.jsxs("h1",{className:"credit-history-page__title",children:[t.jsx(N,{}),"Credit History"]}),t.jsx("p",{className:"credit-history-page__subtitle",children:"View all completed credit applications"})]}),t.jsxs("div",{className:"credit-history-page__filters",children:[t.jsxs("button",{className:`credit-history-page__filter ${a==="all"?"credit-history-page__filter--active":""}`,onClick:()=>o("all"),children:["All (",c.length,")"]}),t.jsxs("button",{className:`credit-history-page__filter ${a==="approved"?"credit-history-page__filter--active":""}`,onClick:()=>o("approved"),children:["Approved (",c.filter(e=>{var i,r;return(((i=e.creditDecision)==null?void 0:i.decision)||((r=e.creditDecision)==null?void 0:r.status))==="APPROVED"}).length,")"]}),t.jsxs("button",{className:`credit-history-page__filter ${a==="rejected"?"credit-history-page__filter--active":""}`,onClick:()=>o("rejected"),children:["Rejected (",c.filter(e=>{var i,r;return(((i=e.creditDecision)==null?void 0:i.decision)||((r=e.creditDecision)==null?void 0:r.status))==="REJECTED"}).length,")"]}),t.jsxs("button",{className:`credit-history-page__filter ${a==="manual_review"?"credit-history-page__filter--active":""}`,onClick:()=>o("manual_review"),children:["Manual Review (",c.filter(e=>{var i,r;return(((i=e.creditDecision)==null?void 0:i.decision)||((r=e.creditDecision)==null?void 0:r.status))==="MANUAL_REVIEW"}).length,")"]})]}),t.jsx("div",{className:"credit-history-page__content",children:y.length===0?t.jsxs("div",{className:"credit-history-page__empty",children:[t.jsx(N,{className:"credit-history-page__empty-icon"}),t.jsx("h3",{children:"No Applications Found"}),t.jsx("p",{children:a==="all"?"You haven't completed any credit applications yet.":`No ${a==="approved"?"approved":a==="rejected"?"rejected":"manual review"} applications found.`}),t.jsx(P,{label:"Start New Application",onClick:()=>m("/credit-request"),variant:"btn-primary"})]}):t.jsx("div",{className:"credit-history-page__list",children:y.map(e=>{var s,i,r,p,j,x;return t.jsxs("div",{className:"credit-history-item",onClick:()=>u(e),children:[t.jsxs("div",{className:"credit-history-item__header",children:[t.jsxs("div",{className:"credit-history-item__status",children:[E(e.status,e.creditDecision),t.jsx("span",{className:"credit-history-item__status-label",children:R(e.creditDecision)})]}),t.jsxs("div",{className:"credit-history-item__actions",children:[t.jsx("button",{className:"credit-history-item__action",onClick:n=>u(e,n),title:"View Details",children:t.jsx(F,{})}),t.jsx("button",{className:"credit-history-item__action credit-history-item__action--delete",onClick:n=>A(e.applicationId,n),title:"Delete",children:t.jsx(V,{})})]})]}),t.jsx("div",{className:"credit-history-item__body",children:t.jsxs("div",{className:"credit-history-item__info",children:[t.jsxs("div",{className:"credit-history-item__info-row",children:[t.jsx("span",{className:"credit-history-item__label",children:"Customer:"}),t.jsx("span",{className:"credit-history-item__value",children:((s=e.customer)==null?void 0:s.fullName)||"N/A"})]}),t.jsxs("div",{className:"credit-history-item__info-row",children:[t.jsx("span",{className:"credit-history-item__label",children:"Product:"}),t.jsx("span",{className:"credit-history-item__value",children:((i=e.product)==null?void 0:i.name)||"N/A"})]}),t.jsxs("div",{className:"credit-history-item__info-row",children:[t.jsx("span",{className:"credit-history-item__label",children:"Amount:"}),t.jsx("span",{className:"credit-history-item__value credit-history-item__value--amount",children:w(((r=e.creditDecision)==null?void 0:r.maxApprovedAmount)||((p=e.product)==null?void 0:p.price))})]}),((j=e.creditDecision)==null?void 0:j.interestRate)&&t.jsxs("div",{className:"credit-history-item__info-row",children:[t.jsx("span",{className:"credit-history-item__label",children:"Interest Rate:"}),t.jsxs("span",{className:"credit-history-item__value",children:[e.creditDecision.interestRate,"%"]})]}),((x=e.creditDecision)==null?void 0:x.termMonths)&&t.jsxs("div",{className:"credit-history-item__info-row",children:[t.jsx("span",{className:"credit-history-item__label",children:"Term:"}),t.jsxs("span",{className:"credit-history-item__value",children:[e.creditDecision.termMonths," months"]})]})]})}),t.jsxs("div",{className:"credit-history-item__footer",children:[t.jsxs("div",{className:"credit-history-item__meta",children:[t.jsxs("span",{className:"credit-history-item__id",children:["ID: ",e.applicationId]}),t.jsx("span",{className:"credit-history-item__date",children:C(e.completedAt)})]}),e.hasSignature&&t.jsxs("div",{className:"credit-history-item__badge",children:[t.jsx(k,{}),"Signed"]})]})]},e.applicationId)})})})]})}export{J as default};
