import{r as i,j as e,i as O,u as z,m as T,h as L,B as C}from"./index-DNAaTtSt.js";import{T as h}from"./Toast-D2SR_lEB.js";import{S as A}from"./StepIndicator-B7GmfFl4.js";import{I as j,D as K}from"./DateField-C3ykQJyi.js";import{m as I,C as U}from"./customers-DBIsCxCR.js";import{a as q,b as G,c as S,d as w}from"./creditApplicationStorage-CWb-_15N.js";import"./floating-ui.dom-2mXtW4pO.js";function H({idImage:m,onDataExtracted:o}){const[n,c]=i.useState(null),[f,r]=i.useState(!1);i.useEffect(()=>{m&&!n&&(r(!0),setTimeout(()=>{const s={fullName:"MEKELEBOVSKI BOSHKO",personalNumber:"0405985420024",idNumber:"B0399880",dateOfBirth:new Date("1985-05-04"),documentType:"ID CARD"};c(s),r(!1),o&&o(s)},2e3))},[m,n,o]);const l=(s,u)=>{c(N=>({...N,[s]:u}))};return m?f?e.jsxs("div",{className:"ocr-data-extraction",children:[e.jsx("h3",{className:"ocr-data-extraction__title",children:"OCR Data Extraction and Identity Information"}),e.jsxs("div",{className:"ocr-data-extraction__processing",children:[e.jsx("div",{className:"ocr-data-extraction__spinner"}),e.jsx("p",{children:"Processing ID card image..."}),e.jsx("p",{className:"ocr-data-extraction__processing-hint",children:"Extracting text and data from document"})]})]}):e.jsxs("div",{className:"ocr-data-extraction",children:[e.jsx("h3",{className:"ocr-data-extraction__title",children:"OCR Data Extraction and Identity Information"}),n?e.jsxs("div",{className:"ocr-data-extraction__form",children:[e.jsx(j,{label:"Full Name",marginBottom:"mb-0",name:"fullName",value:n.fullName,onChange:s=>l("fullName",s)}),e.jsx(j,{label:"Personal Number",marginBottom:"mb-0",name:"personalNumber",value:n.personalNumber,onChange:s=>l("personalNumber",s)}),e.jsx(j,{label:"ID Number",marginBottom:"mb-0",name:"idNumber",value:n.idNumber,onChange:s=>l("idNumber",s)}),e.jsx(K,{label:"Date of Birth",marginBottom:"mb-0",name:"dateOfBirth",value:n.dateOfBirth,onChange:s=>l("dateOfBirth",s),withTime:!1,showYearDropdown:!0,showMonthDropdown:!0})]}):e.jsx("div",{className:"ocr-data-extraction__empty",children:e.jsx("p",{children:"No data extracted yet"})})]}):e.jsxs("div",{className:"ocr-data-extraction",children:[e.jsx("h3",{className:"ocr-data-extraction__title",children:"OCR Data Extraction and Identity Information"}),e.jsx("div",{className:"ocr-data-extraction__empty",children:e.jsx("p",{children:"Upload an ID card image to extract customer information"})})]})}function Z(){var g;const m=O(),o=z(),n=i.useRef(null),[c,f]=i.useState(null),[r,l]=i.useState(null),[s,u]=i.useState(null),[N,_]=i.useState(null),[v,p]=i.useState(null),b=(g=m.state)==null?void 0:g.product;i.useEffect(()=>{const a=q(),t=G();if(a!=null&&a.preview&&(l(a.preview),a.fileName&&u(a.fileName)),t&&(_(t),t.idNumber)){const d=I.find(x=>x.idNumber===t.idNumber);d&&p(d.id)}},[]);const E=[{label:"Product",description:"Selection"},{label:"Identity",description:"Verification"},{label:"Details",description:"Loan Details"},{label:"Review",description:"Application"}],y=()=>{var a;(a=n.current)==null||a.click()},B=a=>{var d;const t=(d=a.target.files)==null?void 0:d[0];if(t)if(t.type.startsWith("image/")){f(t);const x=new FileReader;x.onloadend=()=>{const D=x.result;l(D),u(t.name),S({preview:D,fileName:t.name})},x.readAsDataURL(t),h.success("ID card image selected")}else h.error("Please select an image file")},R=()=>{f(null),l(null),u(null),n.current&&(n.current.value=""),S(null),w(null),_(null),p(null),h.info("Image removed")},P=a=>{if(_(a),w(a),a.idNumber){const t=I.find(d=>d.idNumber===a.idNumber);t?(p(t.id),h.success("Customer found in database")):p(null)}},k=()=>{if(!r&&!c){h.error("Please select an ID card image");return}o("/credit-request/customer-info",{state:{product:b,idImage:r,extractedData:N,method:"scan"}})},F=()=>{o("/credit-request",{state:{product:b}})};return e.jsxs("div",{className:"id-scan-screen",children:[e.jsxs("div",{className:"id-scan-screen__header",children:[e.jsx("h1",{className:"id-scan-screen__title",children:"Scan ID Card"}),e.jsx("p",{className:"id-scan-screen__subtitle",children:"Upload or capture an image of the customer's ID card"})]}),e.jsxs("div",{className:"id-scan-screen__content",children:[e.jsx(A,{steps:E,currentStep:2}),e.jsxs("div",{className:"id-scan-screen__main",children:[e.jsxs("div",{className:"id-scan-screen__layout",children:[e.jsx("div",{className:"id-scan-screen__left",children:e.jsx("div",{className:"id-scan-screen__upload-area",children:r?e.jsxs("div",{className:"id-scan-screen__preview",children:[e.jsxs("div",{className:"id-scan-screen__preview-header",children:[e.jsxs("div",{className:"id-scan-screen__preview-status",children:[e.jsx(L,{}),e.jsx("span",{children:"Image Selected"})]}),e.jsx("button",{className:"id-scan-screen__remove-btn",onClick:R,children:"Remove"})]}),e.jsx("div",{className:"id-scan-screen__preview-image",children:e.jsx("img",{src:r,alt:"ID Card Preview"})}),e.jsx("p",{className:"id-scan-screen__preview-filename",children:s||(c==null?void 0:c.name)||"ID Card Image"})]}):e.jsxs("div",{className:"id-scan-screen__dropzone",onClick:y,children:[e.jsx("div",{className:"id-scan-screen__dropzone-icon",children:e.jsx(T,{})}),e.jsx("h3",{className:"id-scan-screen__dropzone-title",children:"Select ID Card Image"}),e.jsx("p",{className:"id-scan-screen__dropzone-text",children:"Click here to browse and select an image file"}),e.jsx("p",{className:"id-scan-screen__dropzone-hint",children:"Supported formats: JPG, PNG, PDF"}),e.jsx("input",{ref:n,type:"file",accept:"image/*,.pdf",onChange:B,style:{display:"none"}})]})})}),e.jsxs("div",{className:"id-scan-screen__right",children:[e.jsx(H,{idImage:r,onDataExtracted:P}),v&&e.jsx("div",{className:"id-scan-screen__credit-history",children:e.jsx(U,{customerId:v})})]})]}),e.jsxs("div",{className:"id-scan-screen__actions",children:[e.jsx(C,{label:"Back",onClick:F,variant:"btn-outline"}),e.jsx(C,{label:"Continue",onClick:k,variant:"btn-primary",disabled:!r&&!c})]})]})]})]})}export{Z as default};
