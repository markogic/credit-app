import{i as S,u as O,r as P,j as e,B as j,p as A,k as y,x as C,y as w,z as I,h as E}from"./index-B5oqQfuu.js";import{T as D}from"./Toast-D2SR_lEB.js";import{S as B}from"./StepIndicator-Cyy8RdIP.js";import{a as F}from"./ProcessOverlay-B_zzwI_s.js";import{g as k}from"./products-CCmYG3A5.js";const V=()=>{try{const i=localStorage.getItem("credit_thresholds");if(i)return JSON.parse(i)}catch(i){console.error("Error loading threshold settings:",i)}return{rejected:{min:0,max:60},manualReview:{min:60,max:75},approved:{min:75,max:100},overruleMin:72,overruleMax:75}},N=(i,c)=>{const{rejected:r,manualReview:o,approved:t,overruleMin:n,overruleMax:a}=c;return i>=r.min&&i<r.max?{decision:"REJECTED",isOverruleApproval:!1}:i>=t.min&&i<=t.max?{decision:"APPROVED",isOverruleApproval:!1}:i>=o.min&&i<o.max?i>=n&&i<=a?{decision:"APPROVED",isOverruleApproval:!0,overruleMin:n,overruleMax:a}:{decision:"MANUAL_REVIEW",isOverruleApproval:!1}:{decision:"MANUAL_REVIEW",isOverruleApproval:!1}},q=i=>{const c=Math.random(),r=V();let o,t,n,a,u=null,s=!1,p=null,v=null;if(c<.7){const l=r.approved.max-r.approved.min,x=r.overruleMax-r.overruleMin,f=l+x;Math.random()<l/f?t=Math.floor(Math.random()*(r.approved.max-r.approved.min+1))+r.approved.min:t=Math.floor(Math.random()*(r.overruleMax-r.overruleMin+1))+r.overruleMin;const m=N(t,r);o=m.decision,s=m.isOverruleApproval||!1,m.isOverruleApproval&&(p=m.overruleMin,v=m.overruleMax),n=parseFloat((Math.random()*2+2.5).toFixed(2)),a=[12,18,24,36][Math.floor(Math.random()*4)]}else if(c<.85){r.manualReview.max-r.manualReview.min,r.overruleMax-r.overruleMin,Math.random()<.5&&r.manualReview.min<r.overruleMin?t=Math.floor(Math.random()*(r.overruleMin-r.manualReview.min))+r.manualReview.min:r.overruleMax<r.manualReview.max?t=Math.floor(Math.random()*(r.manualReview.max-r.overruleMax))+r.overruleMax:t=Math.floor(Math.random()*(r.manualReview.max-r.manualReview.min+1))+r.manualReview.min;const l=N(t,r);o=l.decision,s=l.isOverruleApproval||!1,n=parseFloat((Math.random()*2+3.5).toFixed(2)),a=[12,18,24][Math.floor(Math.random()*3)]}else if(c<.95)t=Math.floor(Math.random()*(r.rejected.max-r.rejected.min+1))+r.rejected.min,o=N(t,r).decision,n=null,a=null;else{o="ERROR",t=null,n=null,a=null;const l=["Unable to connect to credit bureau system","Timeout error while processing request","Invalid customer data format","System temporarily unavailable","Data validation failed"];u=l[Math.floor(Math.random()*l.length)]}const h=o==="APPROVED"||o==="MANUAL_REVIEW"?i:0,_=(o==="APPROVED"||o==="MANUAL_REVIEW")&&n&&a?parseFloat((i*(1+n/100)/a).toFixed(2)):0;return{decision:o,score:t,maxApprovedAmount:h,interestRate:n,termMonths:a,monthlyPayment:_,errorMessage:u,isOverruleApproval:s,overruleMin:p,overruleMax:v,timestamp:new Date().toISOString()}};function G(){var m,M,g,R,b;const i=S(),c=O(),[r,o]=P.useState(!1),t=(m=i.state)==null?void 0:m.product,n=t?k(t.id):null,a=(M=i.state)==null?void 0:M.customer,u=(g=i.state)==null?void 0:g.idImage,s=(R=i.state)==null?void 0:R.extractedData,p=(b=i.state)==null?void 0:b.method,v=[{label:"Product",description:"Selection"},{label:"Identity",description:"Verification"},{label:"Details",description:"Loan Details"},{label:"Review",description:"Application"}],h=[{title:"Sending Information",description:"Sending application data to Bank System...",icon:e.jsx(w,{})},{title:"Retrieving Credit Data",description:"Retrieving credit information from MKB system...",icon:e.jsx(A,{})},{title:"Analyzing Score Results",description:"Analyzing credit eligibility and scoring...",icon:e.jsx(I,{})},{title:"Preparing Decision Result",description:"Finalizing credit decision and preparing response...",icon:e.jsx(E,{})}],_=()=>{if(!n||!a&&!u&&!s){D.error("Missing required information");return}o(!0)},l=()=>{o(!1);const d=q(n.price);c("/credit-request/review",{state:{product:t,customer:a,idImage:u,extractedData:s,method:p,creditDecision:d}})},x=()=>{p==="scan"?c("/credit-request/scan-id",{state:{product:t}}):c("/credit-request/search-customer",{state:{product:t}})};if(!n)return e.jsx("div",{className:"customer-info-screen",children:e.jsxs("div",{className:"customer-info-screen__error",children:[e.jsx("p",{children:"Product information not found. Please start over."}),e.jsx(j,{label:"Go Back",onClick:()=>c("/credit-request"),variant:"btn-primary"})]})});const f=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(n.price);return e.jsxs("div",{className:"customer-info-screen",children:[e.jsxs("div",{className:"customer-info-screen__header",children:[e.jsx("h1",{className:"customer-info-screen__title",children:"Loan Details"}),e.jsx("p",{className:"customer-info-screen__subtitle",children:"Review product and customer information before requesting credit approval"})]}),e.jsxs("div",{className:"customer-info-screen__content",children:[e.jsx(B,{steps:v,currentStep:3}),e.jsxs("div",{className:"customer-info-screen__main",children:[e.jsxs("div",{className:"loan-details-overview",children:[e.jsxs("div",{className:"loan-details-overview__product",children:[e.jsx("h3",{className:"loan-details-overview__section-title",children:"Product Information"}),e.jsxs("div",{className:"product-card",children:[e.jsx("div",{className:"product-card__icon",children:n.icon&&(()=>{const d=n.icon;return e.jsx(d,{})})()}),e.jsxs("div",{className:"product-card__content",children:[e.jsx("h4",{className:"product-card__name",children:n.name}),e.jsxs("p",{className:"product-card__sku",children:["SKU: ",n.sku]}),e.jsx("p",{className:"product-card__category",children:n.category})]}),e.jsxs("div",{className:"product-card__price",children:[e.jsx("span",{className:"product-card__price-label",children:"Price"}),e.jsx("span",{className:"product-card__price-value",children:f})]})]})]}),e.jsxs("div",{className:"loan-details-overview__customer",children:[e.jsx("h3",{className:"loan-details-overview__section-title",children:"Customer Information"}),a||s?e.jsxs("div",{className:"customer-card",children:[e.jsxs("div",{className:"customer-card__header",children:[e.jsx(A,{className:"customer-card__icon"}),e.jsx("h4",{className:"customer-card__name",children:(a==null?void 0:a.fullName)||(s==null?void 0:s.fullName)||"Customer"})]}),e.jsxs("div",{className:"customer-card__details",children:[((a==null?void 0:a.personalNumber)||(s==null?void 0:s.personalNumber))&&e.jsxs("div",{className:"customer-card__detail",children:[e.jsx(y,{className:"customer-card__detail-icon"}),e.jsxs("div",{className:"customer-card__detail-content",children:[e.jsx("span",{className:"customer-card__detail-label",children:"Personal Number:"}),e.jsx("span",{className:"customer-card__detail-value",children:(a==null?void 0:a.personalNumber)||(s==null?void 0:s.personalNumber)})]})]}),e.jsxs("div",{className:"customer-card__detail",children:[e.jsx(y,{className:"customer-card__detail-icon"}),e.jsxs("div",{className:"customer-card__detail-content",children:[e.jsx("span",{className:"customer-card__detail-label",children:"ID Number:"}),e.jsx("span",{className:"customer-card__detail-value",children:(a==null?void 0:a.idNumber)||(s==null?void 0:s.idNumber)})]})]}),((a==null?void 0:a.dateOfBirth)||(s==null?void 0:s.dateOfBirth))&&e.jsxs("div",{className:"customer-card__detail",children:[e.jsx(C,{className:"customer-card__detail-icon"}),e.jsxs("div",{className:"customer-card__detail-content",children:[e.jsx("span",{className:"customer-card__detail-label",children:"Date of Birth:"}),e.jsx("span",{className:"customer-card__detail-value",children:(()=>{const d=(a==null?void 0:a.dateOfBirth)||(s==null?void 0:s.dateOfBirth);return d?d instanceof Date?d.toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):typeof d=="string"?new Date(d).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):d:"N/A"})()})]})]})]})]}):e.jsx("div",{className:"customer-card customer-card--empty",children:e.jsx("p",{children:"No customer information available"})})]})]}),e.jsxs("div",{className:"customer-info-screen__actions",children:[e.jsx(j,{label:"Back",onClick:x,variant:"btn-outline"}),e.jsx(j,{label:"Request Credit Approval",onClick:_,variant:"btn-primary",icon:e.jsx(w,{})})]})]})]}),e.jsx(F,{isVisible:r,onClose:l,steps:h,stepDuration:1e3,completeDelay:800,autoCloseDelay:800})]})}export{G as default};
